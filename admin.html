<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel Ramadan</title>

<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Segoe UI;
  background:#0f172a;
  color:#fff;
}

.wrapper{
  display:flex;
}

.sidebar{
  width:240px;
  background:#1e293b;
  height:100vh;
  padding:20px;
}

.sidebar h2{
  color:#facc15;
}

.sidebar ul{
  list-style:none;
  padding:0;
}

.sidebar li{
  padding:12px;
  cursor:pointer;
  border-radius:8px;
  margin-bottom:6px;
}

.sidebar li:hover{
  background:#334155;
}

.content{
  flex:1;
  padding:25px;
}

.card{
  background:#1e293b;
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}

.grid-3{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
}

.stat{
  font-size:24px;
  font-weight:bold;
  margin-top:10px;
  color:#facc15;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:12px;
}

th,td{
  border:1px solid #334155;
  padding:6px;
  text-align:left;
}

th{
  background:#334155;
}

.hidden{
  display:none;
}

select{
  padding:6px;
  border-radius:6px;
  background:#1e293b;
  color:#fff;
  border:1px solid #334155;
}
</style>
</head>

<body>

<div class="wrapper">

<div class="sidebar">
  <h2>Ramadan Panel</h2>
  <ul>
    <li onclick="showPage('dashboard')">Dashboard</li>
    <li onclick="showPage('manajemen')">Manajemen</li>
    <li onclick="showPage('siswa')">Data Siswa</li>
    <li onclick="showPage('pembimbing')">Data Pembimbing</li>
    <li onclick="showPage('kelompok')">Kelompok</li>
    <li onclick="showPage('operasional')">Operasional</li>
    <li onclick="showPage('penilaian')">Penilaian</li>
    <li onclick="showPage('laporan')">Laporan</li>
    <li onclick="showPage('sertifikat')">Sertifikat</li>
  </ul>
</div>

<div class="content">

<!-- DASHBOARD -->
<div id="dashboard">
  <div class="card">
    <h3>Statistik Ramadan</h3>
    <div class="grid-3">
      <div>
        Total Siswa
        <div class="stat" id="totalSiswa">0</div>
      </div>
      <div>
        Total Laporan
        <div class="stat" id="totalLaporan">0</div>
      </div>
      <div>
        Rata-rata Nilai
        <div class="stat" id="rataNilai">0</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Top 5 Nilai Tertinggi</h3>
    <ul id="topRanking"></ul>
  </div>
</div>

<!-- LAPORAN -->
<div id="laporan" class="hidden">
  <div class="card">
    <h3>Data Laporan</h3>
    <table id="tableLaporan">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- PAGE LAINNYA -->
<div id="manajemen" class="hidden"><div class="card">Halaman Manajemen</div></div>
<div id="siswa" class="hidden"><div class="card">Halaman Data Siswa</div></div>
<div id="pembimbing" class="hidden"><div class="card">Halaman Data Pembimbing</div></div>
<div id="kelompok" class="hidden"><div class="card">Halaman Kelompok</div></div>
<div id="operasional" class="hidden"><div class="card">Halaman Operasional</div></div>
<div id="penilaian" class="hidden"><div class="card">Halaman Penilaian</div></div>
<div id="sertifikat" class="hidden"><div class="card">Halaman Sertifikat</div></div>

</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz9YCqyJTYQkOfljm1Pbqxy7QoCw9apkHBhDYRVwjRHcihPDN1hn5vpyxkoJ9HqkFCv5g/exec";

let globalData=[];

function showPage(page){
  document.querySelectorAll(".content > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById(page).classList.remove("hidden");
}

function getField(obj,key){
  return obj[key] || obj[key.charAt(0).toUpperCase()+key.slice(1)] || "";
}

function hitungAktivitas(item){
  const aktivitas=[
    "Sahur_Status","Subuh_Status","Olahraga_Status","Keluarga_Status",
    "Dzuhur_Status","Pesantren_Status","Ashar_Status","Aksi_Status",
    "Buka_Status","Magrib_Status","Isya_Status",
    "Tarawih_Status","Tadarus_Status","Tidur_Status"
  ];
  let total=0;
  aktivitas.forEach(k=>{
    if(item[k] && item[k].toString().toLowerCase().includes("valid")){
      total++;
    }
  });
  return total;
}

async function loadData(){
  const res=await fetch(SCRIPT_URL);
  const raw=await res.json();

  if(Array.isArray(raw)) globalData=raw;
  else if(raw.data) globalData=raw.data;
  else globalData=[];

  renderDashboard();
  renderTable();
}

function renderDashboard(){
  const siswaSet=new Set();
  let totalNilai=0;

  globalData.forEach(item=>{
    siswaSet.add(getField(item,"Nama"));
    totalNilai+=Number(getField(item,"Nilai_Pembimbing")||0);
  });

  document.getElementById("totalSiswa").innerText=siswaSet.size;
  document.getElementById("totalLaporan").innerText=globalData.length;
  document.getElementById("rataNilai").innerText=
    globalData.length ? (totalNilai/globalData.length).toFixed(1):0;

  const ranking={};

  globalData.forEach(item=>{
    const nama=getField(item,"Nama");
    const nilai=Number(getField(item,"Nilai_Pembimbing")||0);
    if(!ranking[nama]) ranking[nama]=0;
    ranking[nama]+=nilai;
  });

  const top=Object.entries(ranking)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,5);

  document.getElementById("topRanking").innerHTML=
    top.map((r,i)=>`<li>${i+1}. ${r[0]} - ${r[1]}</li>`).join("");
}

function renderTable(){
  const table=document.getElementById("tableLaporan");
  if(globalData.length===0) return;

  const headers=Object.keys(globalData[0]);

  table.querySelector("thead").innerHTML=
    "<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>";

  table.querySelector("tbody").innerHTML=
    globalData.map(row=>
      "<tr>"+headers.map(h=>`<td>${row[h]}</td>`).join("")+"</tr>"
    ).join("");
}

document.addEventListener("DOMContentLoaded",loadData);
</script>

</body>
</html>
