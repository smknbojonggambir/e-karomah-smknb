<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - E-KAROMAH</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #10b981; --gold: #fbbf24; --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: rgba(255,255,255,0.1); }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); }
        .layout { display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }
        aside { background: #020617; padding: 20px; border-right: 1px solid var(--border); }
        .brand { font-size: 20px; font-weight: 700; color: var(--gold); margin-bottom: 40px; display: block; }
        .nav-item { padding: 12px; color: #94a3b8; border-radius: 8px; cursor: pointer; margin-bottom: 5px; transition: 0.3s; }
        .nav-item:hover { background: rgba(255,255,255,0.05); }
        .nav-item.active { background: rgba(16, 185, 129, 0.15); color: var(--primary); }
        main { padding: 30px; height: 100vh; overflow-y: auto; box-sizing: border-box; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); font-size: 13px; }
        th { color: #94a3b8; background: rgba(0,0,0,0.2); text-transform: uppercase; letter-spacing: 1px; }
        tr:hover { background: rgba(255,255,255,0.02); }
    </style>
</head>
<body>
    <div class="layout">
        <aside>
            <div class="brand">ðŸŒ™ E-KAROMAH</div>
            <div class="nav-item active" onclick="showPage('dash', this)">ðŸ“Š Dashboard</div>
            <div class="nav-item" onclick="showPage('siswa', this)">ðŸ‘¥ Data Siswa</div>
            <div class="nav-item" onclick="showPage('guru', this)">ðŸ‘” Data Pembimbing</div>
        </aside>
        <main>
            <div id="page-dash" class="page active">
                <h1>Overview</h1>
                <div class="card"><canvas id="myChart" height="100"></canvas></div>
            </div>

            <div id="page-siswa" class="page">
                <h1>Data Siswa</h1>
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Nama</th>
                                <th>Kelompok</th>
                            </tr>
                        </thead>
                        <tbody id="listSiswa">
                            <tr><td colspan="3">Memuat data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="page-guru" class="page">
                <h1>Data Pembimbing</h1>
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Nama</th>
                                <th>Kelompok</th>
                            </tr>
                        </thead>
                        <tbody id="listGuru">
                            <tr><td colspan="3">Memuat data...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API = "https://script.google.com/macros/s/AKfycbyHBpOUspomuKZ75MGmMoD0ZYuYxjif5FmGfPb6AoVzGC3fFjUmwD1wOfJKggb0F3cYhQ/exec";

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            el.classList.add('active');
        }

        async function loadData() {
            try {
                const res = await fetch(API + "?action=getUsers");
                const data = await res.json();
                
                // Render Siswa - Menggunakan key 'Nama' sesuai header GS
                document.getElementById('listSiswa').innerHTML = data.siswa.length > 0 ? 
                    data.siswa.map(u => 
                        `<tr>
                            <td>${u.Username || '-'}</td>
                            <td>${u.Nama || '-'}</td>
                            <td>${u.Kelompok || '-'}</td>
                        </tr>`
                    ).join('') : '<tr><td colspan="3" style="text-align:center">Tidak ada data siswa</td></tr>';

                // Render Pembimbing - Menggunakan key 'Nama' sesuai header GS
                document.getElementById('listGuru').innerHTML = data.pembimbing.length > 0 ? 
                    data.pembimbing.map(u => 
                        `<tr>
                            <td>${u.Username || '-'}</td>
                            <td>${u.Nama || '-'}</td>
                            <td>${u.Kelompok || '-'}</td>
                        </tr>`
                    ).join('') : '<tr><td colspan="3" style="text-align:center">Tidak ada data pembimbing</td></tr>';

                renderChart(data);
            } catch(e) { 
                console.error("Error loading data:", e);
                document.getElementById('listSiswa').innerHTML = '<tr><td colspan="3">Gagal memuat data.</td></tr>';
            }
        }

        function renderChart(data) {
            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Siswa', 'Pembimbing'],
                    datasets: [{
                        label: 'Total User',
                        data: [data.siswa.length, data.pembimbing.length],
                        backgroundColor: ['#10b981', '#fbbf24']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } } }
                }
            });
        }

        loadData();
    </script>
</body>
</html>
