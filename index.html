<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-KAROMAH SMKNB</title>

<style>
:root{
  --bg:#0d1117;
  --card:#161b22;
  --border:#30363d;
  --accent:#2ea043;
  --text:#e6edf3;
}

body{
  margin:0;
  font-family:Segoe UI;
  background:var(--bg);
  color:var(--text);
}

.navbar{
  background:var(--card);
  padding:15px 25px;
  display:flex;
  align-items:center;
  gap:15px;
  border-bottom:1px solid var(--border);
}

.navbar img{height:45px}

.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  border:1px solid var(--border);
  margin-bottom:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:15px;
}

input,select{
  width:100%;
  padding:8px;
  margin-top:5px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#0d1117;
  color:white;
}

button{
  background:var(--accent);
  padding:12px;
  border:none;
  border-radius:8px;
  color:white;
  font-weight:bold;
  margin-top:20px;
  width:100%;
}
</style>
</head>

<body>

<div class="navbar">
  <img src="https://raw.githubusercontent.com/smknbojonggambir/E-RAMADHAN-SMKNB/main/LOGO.png">
  <h2>E-KAROMAH SMKNB</h2>
</div>

<div class="container">

<div class="card">
<h3>Lokasi GPS</h3>
<input type="text" id="lat" placeholder="Latitude" readonly>
<input type="text" id="long" placeholder="Longitude" readonly>
</div>

<div class="card">
<h3>Input Kegiatan Harian</h3>

<div class="grid">

<input type="time" id="sahur_waktu">
<input type="file" id="sahur_foto">

<select id="subuh"><option>Ya</option><option>Tidak</option></select>

<input type="file" id="olahraga">
<input type="file" id="keluarga">

<select id="dzuhur"><option>Ya</option><option>Tidak</option></select>

<input type="file" id="pesantren">

<select id="ashar"><option>Ya</option><option>Tidak</option></select>

<input type="file" id="aksi">
<input type="file" id="buka">

<select id="magrib"><option>Ya</option><option>Tidak</option></select>
<select id="isya"><option>Ya</option><option>Tidak</option></select>
<select id="taraweh"><option>Ya</option><option>Tidak</option></select>

<input type="file" id="tadarus">

<input type="time" id="tidur">

<select id="sedekah"><option>Ya</option><option>Tidak</option></select>

</div>

<button onclick="kirim()">SIMPAN LAPORAN</button>

</div>
</div>

<script>

navigator.geolocation.getCurrentPosition(function(pos){
  document.getElementById("lat").value = pos.coords.latitude;
  document.getElementById("long").value = pos.coords.longitude;
});

async function kirim(){

  function toBase64(file){
    return new Promise(resolve=>{
      const reader = new FileReader();
      reader.onload = ()=> resolve(reader.result);
      reader.readAsDataURL(file);
    });
  }

  let data = {
    tanggal:new Date().toLocaleDateString(),
    lat:lat.value,
    long:long.value,
    sahur_waktu:sahur_waktu.value,
    subuh:subuh.value,
    dzuhur:dzuhur.value,
    ashar:ashar.value,
    magrib:magrib.value,
    isya:isya.value,
    taraweh:taraweh.value,
    tidur:tidur.value,
    sedekah:sedekah.value
  };

  async function handleFile(id,name){
    let fileInput = document.getElementById(id);
    if(fileInput.files.length>0){
      let file = fileInput.files[0];
      data[name] = await toBase64(file);
      data[name+"_mime"] = file.type;
    }
  }

  await handleFile("sahur_foto","sahur_foto");
  await handleFile("olahraga","olahraga");
  await handleFile("keluarga","keluarga");
  await handleFile("pesantren","pesantren");
  await handleFile("aksi","aksi");
  await handleFile("buka","buka");
  await handleFile("tadarus","tadarus");

  google.script.run.withSuccessHandler(res=>{
    alert(res);
    location.reload();
  }).saveLaporan(data);
}
</script>

</body>
</html>
