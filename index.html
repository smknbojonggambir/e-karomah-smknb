<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>E-KAROMAH SMKNB</title>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;padding:20px}
.card{background:#1e293b;padding:20px;border-radius:12px;max-width:600px;margin:auto}
select,input,textarea,button{width:100%;margin:8px 0;padding:10px;border-radius:8px;border:none}
button{background:#2563eb;color:#fff;font-weight:bold}
</style>
</head>
<body>

<div class="card">
<h2>E-KAROMAH SMKNB</h2>

<select id="kelompok" onchange="loadNama()">
<option value="">Pilih Kelompok</option>
</select>

<select id="nama" disabled></select>

<input type="hidden" id="lat">
<input type="hidden" id="long">

<input type="time" id="sahur_waktu">
<input type="file" id="sahur_foto">
<textarea id="sahur_ket"></textarea>

<label>Subuh</label>
<select id="subuh_status">
<option value="Ya">Ya</option>
<option value="Tidak">Tidak</option>
</select>

<button onclick="kirim()">Kirim</button>
</div>

<script>
const WEB_APP_URL="https://script.google.com/macros/s/AKfycbyRrs16PVP3CujhHMI_GG0z8MIgx9gCQ1ZNiDG0dqG3zyDukpWjZk8CrbGEnrMEyQ6fxw/exec";

navigator.geolocation.getCurrentPosition(pos=>{
document.getElementById("lat").value=pos.coords.latitude;
document.getElementById("long").value=pos.coords.longitude;
});

async function loadKelompok(){
const res=await fetch(WEB_APP_URL+"?action=getKelompok");
const data=await res.json();
let s=document.getElementById("kelompok");
data.forEach(k=>{
let o=document.createElement("option");
o.value=k;o.textContent=k;s.appendChild(o);
});
}

async function loadNama(){
let k=document.getElementById("kelompok").value;
const res=await fetch(WEB_APP_URL+"?action=getNama&kelompok="+k);
const data=await res.json();
let s=document.getElementById("nama");
s.innerHTML="";
data.forEach(n=>{
let o=document.createElement("option");
o.value=n;o.textContent=n;s.appendChild(o);
});
s.disabled=false;
}

async function kirim(){
let fd=new FormData();
fd.append("tanggal",new Date().toLocaleDateString());
fd.append("username",document.getElementById("nama").value);
fd.append("nama",document.getElementById("nama").value);
fd.append("kelompok",document.getElementById("kelompok").value);
fd.append("lat",document.getElementById("lat").value);
fd.append("long",document.getElementById("long").value);

fd.append("sahur_waktu",sahur_waktu.value);
fd.append("sahur_foto",sahur_foto.files[0]);
fd.append("sahur_ket",sahur_ket.value);
fd.append("subuh_status",subuh_status.value);

await fetch(WEB_APP_URL,{method:"POST",body:fd});
alert("Berhasil!");
location.reload();
}

loadKelompok();
</script>
</body>
</html>
