<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>E-KAROMAH SMKNB</title>

<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  padding:20px;
}

.card{
  max-width:420px;
  margin:auto;
  background:rgba(255,255,255,.08);
  padding:25px;
  border-radius:12px;
  margin-bottom:20px;
}

input,textarea,button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}

button{
  background:#2563eb;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.hidden{display:none}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}

td,th{
  border:1px solid white;
  padding:5px;
  text-align:center;
}
</style>
</head>

<body>

<h2 align="center">E-KAROMAH SMKNB</h2>


<!-- LOGIN -->
<div id="loginBox" class="card">

<h3>Login</h3>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">

<button onclick="login()">Login</button>

<p id="msg"></p>

</div>


<!-- DASHBOARD -->
<div id="dashBox" class="hidden">

<!-- INFO -->
<div class="card">

<h3 id="welcome"></h3>
<p id="roleInfo"></p>

<button onclick="logout()">Logout</button>

</div>


<!-- FORM SISWA -->
<div id="formSiswa" class="card hidden">

<h3>Input Laporan Harian</h3>

<textarea id="laporan" rows="5"
placeholder="Tulis kegiatan hari ini..."></textarea>

<button onclick="kirim()">Kirim</button>

</div>


<!-- MONITOR -->
<div id="monitorBox" class="card hidden">

<h3>Monitoring Laporan</h3>

<button onclick="loadData()">Refresh</button>

<div id="tabel"></div>

</div>

</div>


<script>

// =============================
// GANTI URL WEB APP ANDA
// =============================
const URL="PASTE_WEBAPP_URL_DISINI";


// =============================
// LOGIN
// =============================
async function login(){

  let u=encodeURIComponent(username.value.trim());
  let p=encodeURIComponent(password.value.trim());

  let res=await fetch(
    `${URL}?action=login&username=${u}&password=${p}`
  );

  let data=await res.json();

  console.log(data);

  if(data.status=="success"){

    localStorage.setItem("user",JSON.stringify(data));

    showDash(data);

  }else{
    msg.innerHTML="‚ùå Login gagal";
  }
}


// =============================
// TAMPIL DASHBOARD
// =============================
function showDash(user){

  loginBox.classList.add("hidden");
  dashBox.classList.remove("hidden");

  welcome.innerHTML="Halo, "+user.nama;
  roleInfo.innerHTML="Role: "+user.role;

  if(user.role=="Siswa"){
    formSiswa.classList.remove("hidden");
  }

  if(user.role=="Pembimbing" || user.role=="Admin"){
    monitorBox.classList.remove("hidden");
    loadData();
  }
}


// =============================
// LOGOUT
// =============================
function logout(){
  localStorage.clear();
  location.reload();
}


// =============================
// KIRIM LAPORAN (SISWA)
// =============================
async function kirim(){

  let user=JSON.parse(localStorage.getItem("user"));

  let data={
    action:"kirim",
    username:user.username,
    nama:user.nama,
    kelompok:user.kelompok,
    laporan:laporan.value
  };

  await fetch(URL,{
    method:"POST",
    body:JSON.stringify(data)
  });

  alert("Berhasil dikirim");

  laporan.value="";
}


// =============================
// LOAD DATA (PEMBIMBING / ADMIN)
// =============================
async function loadData(){

  let user=JSON.parse(localStorage.getItem("user"));

  let res=await fetch(
    `${URL}?action=getData&role=${user.role}&kelompok=${user.kelompok}`
  );

  let data=await res.json();

  let html="<table>";

  html+=`
    <tr>
      <th>Tanggal</th>
      <th>Nama</th>
      <th>Kelompok</th>
      <th>Laporan</th>
    </tr>
  `;

  data.forEach(d=>{

    html+=`
      <tr>
        <td>${d.tgl}</td>
        <td>${d.nama}</td>
        <td>${d.kelompok}</td>
        <td>${d.laporan}</td>
      </tr>
    `;
  });

  html+="</table>";

  tabel.innerHTML=html;
}


// =============================
// AUTO LOGIN
// =============================
let u=localStorage.getItem("user");

if(u){
  showDash(JSON.parse(u));
}

</script>

</body>
</html>
