<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E-KAROMAH SMKNB</title>

<style>
body{
    margin:0;
    font-family:Segoe UI, sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
}
.container{
    max-width:700px;
    margin:auto;
    padding:20px;
}
.card{
    background:white;
    color:#333;
    padding:20px;
    border-radius:15px;
    box-shadow:0 10px 30px rgba(0,0,0,0.3);
}
h1{
    text-align:center;
}
select,input,textarea{
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:8px;
    border:1px solid #ccc;
}
button{
    width:100%;
    padding:12px;
    background:#2c5364;
    color:white;
    border:none;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
}
button:hover{
    background:#1e3c72;
}
.hidden{display:none;}
.loader{
    text-align:center;
    display:none;
}
</style>
</head>
<body>

<div class="container">
<h1>E-KAROMAH SMKNB</h1>

<div class="card">

<select id="kelompok" onchange="loadNama()">
<option value="">Pilih Kelompok</option>
</select>

<select id="nama" onchange="tampilForm()" disabled>
<option value="">Pilih Nama</option>
</select>

<input type="text" id="pembimbing" placeholder="Pembimbing" readonly>

<div id="formInput" class="hidden">

<label>Waktu Sahur</label>
<input type="time" id="sahur_waktu">

<label>Foto Sahur</label>
<input type="file" id="sahur_foto" required>

<label>Foto Olahraga</label>
<input type="file" id="olahraga_foto" required>

<label>Foto Aktivitas Keluarga</label>
<input type="file" id="aktivitas_foto" required>

<label>Foto Pesantren</label>
<input type="file" id="pesantren_foto" required>

<label>Foto Aksi Ekologi</label>
<input type="file" id="aksi_foto" required>

<label>Foto Buka Puasa</label>
<input type="file" id="buka_foto" required>

<label>Foto Tadarus</label>
<input type="file" id="tadarus_foto" required>

<hr>

<label>Subuh</label>
<select id="subuh_status"><option>Ya</option><option>Tidak</option></select>

<label>Dzuhur</label>
<select id="dzuhur_status"><option>Ya</option><option>Tidak</option></select>

<label>Ashar</label>
<select id="ashar_status"><option>Ya</option><option>Tidak</option></select>

<label>Magrib</label>
<select id="magrib_status"><option>Ya</option><option>Tidak</option></select>

<label>Isya</label>
<select id="isya_status"><option>Ya</option><option>Tidak</option></select>

<label>Taraweh</label>
<select id="taraweh_status"><option>Ya</option><option>Tidak</option></select>

<label>Sedekah</label>
<select id="sedekah_status"><option>Ya</option><option>Tidak</option></select>

<button onclick="kirim()">Simpan Data</button>

<div class="loader" id="loader">Mengirim data...</div>

</div>
</div>
</div>

<script>

// GANTI DENGAN URL WEB APP DEPLOY ANDA
const WEB_APP_URL = "ISI_DENGAN_URL_WEB_APP_ANDA";

// =========================
// LOAD KELOMPOK
// =========================
async function loadKelompok(){
const res = await fetch(WEB_APP_URL + "?action=getKelompok");
const data = await res.json();
let s=document.getElementById("kelompok");
data.forEach(k=>{
let o=document.createElement("option");
o.value=k;
o.text=k;
s.appendChild(o);
});
}

// =========================
// LOAD NAMA
// =========================
async function loadNama(){
let k=document.getElementById("kelompok").value;
const res = await fetch(WEB_APP_URL + "?action=getNama&kelompok="+k);
const data = await res.json();

let s=document.getElementById("nama");
s.innerHTML='<option value="">Pilih Nama</option>';
data.forEach(n=>{
let o=document.createElement("option");
o.value=n;
o.text=n;
s.appendChild(o);
});
s.disabled=false;
}

// =========================
// TAMPIL FORM
// =========================
async function tampilForm(){
let k=document.getElementById("kelompok").value;
const res = await fetch(WEB_APP_URL + "?action=getPembimbing&kelompok="+k);
const pembimbing = await res.text();
document.getElementById("pembimbing").value=pembimbing;
document.getElementById("formInput").classList.remove("hidden");
}

// =========================
// KIRIM DATA
// =========================
async function kirim(){

document.getElementById("loader").style.display="block";

let formData = new FormData();
formData.append("action","simpan");

formData.append("kelompok",kelompok.value);
formData.append("nama",nama.value);
formData.append("pembimbing",pembimbing.value);

formData.append("subuh_status",subuh_status.value);
formData.append("dzuhur_status",dzuhur_status.value);
formData.append("ashar_status",ashar_status.value);
formData.append("magrib_status",magrib_status.value);
formData.append("isya_status",isya_status.value);
formData.append("taraweh_status",taraweh_status.value);
formData.append("sedekah_status",sedekah_status.value);

formData.append("sahur_waktu",sahur_waktu.value);

formData.append("sahur_foto",sahur_foto.files[0]);
formData.append("olahraga_foto",olahraga_foto.files[0]);
formData.append("aktivitas_foto",aktivitas_foto.files[0]);
formData.append("pesantren_foto",pesantren_foto.files[0]);
formData.append("aksi_foto",aksi_foto.files[0]);
formData.append("buka_foto",buka_foto.files[0]);
formData.append("tadarus_foto",tadarus_foto.files[0]);

await fetch(WEB_APP_URL,{
method:"POST",
body:formData
});

alert("Data berhasil dikirim!");
document.getElementById("loader").style.display="none";
location.reload();
}

loadKelompok();
</script>

</body>
</html>
