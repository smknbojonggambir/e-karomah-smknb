<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>E-KAROMAH SMKNB</title>

<style>
body{
  font-family:Arial;
  background:#f4f6f9;
  padding:20px;
}
.container{
  max-width:800px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
label{font-weight:bold; display:block; margin-top:10px;}
input,select,textarea{
  width:100%;
  padding:8px;
  margin-top:5px;
  border:1px solid #ccc;
  border-radius:6px;
}
button{
  margin-top:20px;
  padding:12px;
  background:#2c3e50;
  color:white;
  border:none;
  border-radius:6px;
  width:100%;
}
</style>
</head>

<body>
<div class="container">

<h2>E-KAROMAH SMKNB</h2>

<label>Tanggal</label>
<input type="date" id="Tanggal">

<label>Username</label>
<input type="text" id="Username">

<label>Nama</label>
<input type="text" id="Nama">

<label>Kelompok</label>
<select id="Kelompok" onchange="setPembimbing()">
  <option value="">-- Pilih Kelompok --</option>
</select>

<label>Pembimbing</label>
<input type="text" id="Pembimbing" readonly>

<input type="hidden" id="Lat">
<input type="hidden" id="Long">

<button onclick="kirim()">SIMPAN LAPORAN</button>

<div id="hasil"></div>

</div>

<script>

let kelompokData = [];

google.script.run.withSuccessHandler(function(data){

  kelompokData = data;
  const select = document.getElementById("Kelompok");

  data.forEach(item=>{
    let opt = document.createElement("option");
    opt.value = item.kelompok;
    opt.textContent = item.kelompok;
    select.appendChild(opt);
  });

}).getKelompokData();

function setPembimbing(){
  const kelompok = Kelompok.value;
  const found = kelompokData.find(k=>k.kelompok===kelompok);
  Pembimbing.value = found ? found.pembimbing : "";
}

navigator.geolocation.getCurrentPosition(function(pos){
  Lat.value = pos.coords.latitude;
  Long.value = pos.coords.longitude;
});

function kirim(){

  let data = {
    Tanggal: Tanggal.value,
    Username: Username.value,
    Nama: Nama.value,
    Kelompok: Kelompok.value,
    Pembimbing: Pembimbing.value,
    Lat: Lat.value,
    Long: Long.value
  };

  google.script.run.withSuccessHandler(function(res){
    hasil.innerHTML = res;
  }).saveLaporan(data);
}
</script>

</body>
</html>
