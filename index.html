<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>E-KAROMAH SMKNB</title>

<style>
body{
  font-family:Arial;
  background:#0f172a;
  color:white;
  padding:20px;
}

.card{
  max-width:400px;
  margin:auto;
  background:rgba(255,255,255,.08);
  padding:25px;
  border-radius:12px;
}

input,select,button{
  width:100%;
  padding:10px;
  margin:8px 0;
  border-radius:8px;
  border:none;
}

button{
  background:#2563eb;
  color:white;
  font-weight:bold;
}

.hidden{display:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" class="card">
  <h3>Login E-KAROMAH</h3>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">

  <button onclick="login()">Login</button>

  <p id="loginMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="card">
    <h3 id="welcome"></h3>
    <p id="roleInfo"></p>

    <button onclick="logout()">Logout</button>
  </div>

  <!-- FORM SISWA -->
  <div id="formSiswa" class="card hidden">

    <h4>Input Laporan Harian</h4>

    <textarea id="laporan" placeholder="Isi kegiatan hari ini"></textarea>

    <button onclick="kirimLaporan()">Kirim</button>

  </div>

  <!-- MONITOR -->
  <div id="monitorBox" class="card hidden">

    <h4>Monitoring Laporan</h4>

    <button onclick="loadLaporan()">Refresh</button>

    <div id="dataLaporan"></div>

  </div>

</div>


<script>

const URL="https://script.google.com/macros/s/AKfycbyP_1V27hyUaNhBohvn02Rft-X3Q6qjdwbuTDuG0ctnrfKrkNm5Ux30juEcMnO5diLojQ/exec";

/**************** LOGIN *****************/
async function login(){

  let u=username.value;
  let p=password.value;

  let res=await fetch(`${URL}?action=login&username=${u}&password=${p}`);
  let data=await res.json();

  if(data.status=="success"){

    localStorage.setItem("user",JSON.stringify(data));

    showDashboard(data);

  }else{
    loginMsg.innerHTML="‚ùå Login gagal";
  }
}


/**************** DASHBOARD *****************/
function showDashboard(user){

  loginBox.classList.add("hidden");
  dashboard.classList.remove("hidden");

  welcome.innerHTML="Halo, "+user.nama;
  roleInfo.innerHTML="Role: "+user.role;

  if(user.role=="Siswa"){
    formSiswa.classList.remove("hidden");
  }

  if(user.role=="Pembimbing" || user.role=="Admin"){
    monitorBox.classList.remove("hidden");
    loadLaporan();
  }
}


/**************** LOGOUT *****************/
function logout(){
  localStorage.clear();
  location.reload();
}


/**************** KIRIM *****************/
async function kirimLaporan(){

  let user=JSON.parse(localStorage.getItem("user"));

  let data={
    action:"kirim",
    username:user.username,
    nama:user.nama,
    kelompok:user.kelompok,
    laporan:laporan.value
  };

  await fetch(URL,{
    method:"POST",
    body:JSON.stringify(data)
  });

  alert("Berhasil dikirim");
  laporan.value="";
}


/**************** MONITOR *****************/
async function loadLaporan(){

  let res=await fetch(`${URL}?action=getLaporan`);
  let data=await res.json();

  let html="<table border=1 width=100%>";

  html+="<tr><th>Nama</th><th>Kelompok</th><th>Laporan</th><th>Tanggal</th></tr>";

  data.forEach(d=>{
    html+=`
      <tr>
        <td>${d.nama}</td>
        <td>${d.kelompok}</td>
        <td>${d.laporan}</td>
        <td>${d.tgl}</td>
      </tr>
    `;
  });

  html+="</table>";

  dataLaporan.innerHTML=html;
}


/**************** AUTO LOGIN *****************/
let user=localStorage.getItem("user");

if(user){
  showDashboard(JSON.parse(user));
}

</script>

</body>
</html>
